services:
  doc-to-pdf:
    build: .
    ports:
      - "8000:8000"
    environment:
      - CONVERSION_TIMEOUT=120
      - MAX_FILE_SIZE=52428800
      - SHARED_DIR=/shared
      # - API_KEY=your-secret-key  # Uncomment for production
    volumes:
      - shared-files:/shared
    depends_on:
      - onlyoffice
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  onlyoffice:
    image: onlyoffice/documentserver:latest
    environment:
      - JWT_ENABLED=false
    volumes:
      - shared-files:/shared
      - ./onlyoffice-entrypoint.sh:/entrypoint.sh:ro
      - ./fonts:/usr/share/fonts/truetype/custom-extra:ro
    entrypoint: ["/bin/bash", "/entrypoint.sh"]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/healthcheck"]
      interval: 15s
      timeout: 10s
      retries: 20
      start_period: 180s
    restart: unless-stopped

volumes:
  shared-files:
